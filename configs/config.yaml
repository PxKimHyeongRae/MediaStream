# RTSP to WebRTC Media Server Configuration

server:
  # HTTP API 서버 설정
  http_port: 8107
  # WebSocket 시그널링 포트
  ws_port: 8106
  # 프로덕션 모드 (false: 개발 모드)
  production: false

paths:
  CCTV-TEST1:
    source: rtsp://admin:live0416@192.168.10.53:554/Streaming/Channels/101
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-TEST2:
    source: rtsp://admin:live0416@192.168.10.54:554/Streaming/Channels/101
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-TEST3:
    source: rtsp://admin:live0416@192.168.10.55:554/Streaming/Channels/101
    sourceOnDemand: true
    rtspTransport: tcp

  CCTV-JEJU1-31:
    source: rtsp://admin:live0416@221.162.21.246:31554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-32:
    source: rtsp://admin:live0416@221.162.21.246:32554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-33:
    source: rtsp://admin:live0416@221.162.21.246:33554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-34:
    source: rtsp://admin:live0416@221.162.21.246:34554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-35:
    source: rtsp://admin:live0416@221.162.21.246:35554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-36:
    source: rtsp://admin:live0416@221.162.21.246:36554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-37:
    source: rtsp://admin:live0416@221.162.21.246:37554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-38:
    source: rtsp://admin:live0416@221.162.21.246:38554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-39:
    source: rtsp://admin:live0416@221.162.21.246:39554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-40:
    source: rtsp://admin:live0416@221.162.21.246:40554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-41:
    source: rtsp://admin:live0416@221.162.21.246:41554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-42:
    source: rtsp://admin:live0416@221.162.21.246:42554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-43:
    source: rtsp://admin:live0416@221.162.21.246:43554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-44:
    source: rtsp://admin:live0416@221.162.21.246:44554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU1-45:
    source: rtsp://admin:live0416@221.162.21.246:45554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp

  CCTV-JEJU2-31:
    source: rtsp://admin:live0416@121.189.117.243:31554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-32:
    source: rtsp://admin:live0416@121.189.117.243:32554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-33:
    source: rtsp://admin:live0416@121.189.117.243:33554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-34:
    source: rtsp://admin:live0416@121.189.117.243:34554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-35:
    source: rtsp://admin:live0416@121.189.117.243:35554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-36:
    source: rtsp://admin:live0416@121.189.117.243:36554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-37:
    source: rtsp://admin:live0416@121.189.117.243:37554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-38:
    source: rtsp://admin:live0416@121.189.117.243:38554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-39:
    source: rtsp://admin:live0416@121.189.117.243:39554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-40:
    source: rtsp://admin:live0416@121.189.117.243:40554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-41:
    source: rtsp://admin:live0416@121.189.117.243:41554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-42:
    source: rtsp://admin:live0416@121.189.117.243:42554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-43:
    source: rtsp://admin:live0416@121.189.117.243:43554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-44:
    source: rtsp://admin:live0416@121.189.117.243:44554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp
  CCTV-JEJU2-45:
    source: rtsp://admin:live0416@121.189.117.243:45554/profile1/media.smp
    sourceOnDemand: true
    rtspTransport: tcp

# 데이터베이스 설정
database:
  # SQLite 데이터베이스 파일 경로
  path: "data/streams.db"

# 외부 API 설정 (현재 사용 안 함 - 주석처리됨)
# api:
#   # API 사용 활성화
#   enabled: false
#   # API 서버 주소
#   base_url: "http://192.168.10.181:8109"
#   # 인증 정보
#   username: "test"
#   password: "123456"

rtsp:
  # RTSP 서버 설정 (ffmpeg publish/subscribe용)
  server:
    # RTSP 서버 활성화
    enabled: true
    # RTSP 서버 포트
    port: 8554
    # 지원 프로토콜 (tcp, udp)
    protocols:
      - tcp
    # 읽기 타임아웃 (초, 0=무제한)
    read_timeout: 0
    # 쓰기 타임아웃 (초, 0=무제한)
    write_timeout: 0

  # RTSP 클라이언트 설정
  client:
    # 연결 타임아웃 (초) - 외부 IP 연결을 위해 증가
    timeout: 30
    # 재연결 시도 횟수
    retry_count: 3
    # 재연결 대기 시간 (초) - 실패 시 더 빨리 재시도
    retry_delay: 3
    # TCP 전송 사용 (true) 또는 UDP (false)
    tcp_transport: true
    # 온디맨드 스트림 시작 대기 시간 (초)
    on_demand_wait_sec: 2

  # 스트림 풀 설정
  pool:
    # 최대 동시 스트림 수
    max_streams: 100
    # 스트림 헬스 체크 간격 (초)
    health_check_interval: 30

webrtc:
  # ICE 서버 설정
  ice_servers:
    - urls:
      - "stun:stun.l.google.com:19302"
      - "stun:stun1.l.google.com:19302"

  # WebRTC 설정
  settings:
    # 최대 동시 피어 연결 수
    max_peers: 1000
    # 비디오 코덱 우선순위
    video_codecs:
      - "H264"
      - "VP8"
      - "VP9"
    # 오디오 코덱 우선순위
    audio_codecs:
      - "OPUS"
      - "PCMU"
      - "PCMA"

hls:
  # HLS 스트리밍 활성화
  enabled: true
  # 세그먼트 길이 (초) - 카메라 IDR 간격에 맞춤
  segment_duration: 2
  # 플레이리스트에 유지할 세그먼트 수 - 버퍼 안정성을 위해 증가
  segment_count: 6
  # 세그먼트 저장 디렉토리
  output_dir: "hls"
  # 디스크에 유지할 최대 세그먼트 수 - 다중 스트림을 위해 증가
  cleanup_threshold: 30
  # 세그먼트 압축 활성화 (gzip)
  enable_compression: false

media:
  # 미디어 버퍼 설정
  buffer:
    # 비디오 버퍼 크기 (패킷 수) - 다중 스트림을 위해 증가
    video_buffer_size: 1000
    # 오디오 버퍼 크기 (패킷 수)
    audio_buffer_size: 400

  # 코덱 설정
  codec:
    # H264 프로파일
    h264_profile: "baseline"
    # 비트레이트 제한 (kbps, 0 = 제한 없음)
    max_bitrate: 0

logging:
  # 로그 레벨: debug, info, warn, error
  level: "info"
  # 로그 출력: console, file, both
  output: "both"
  # 파일 로그 경로 (output이 file 또는 both일 때)
  # 도커: /app/logs/media-server.log (볼륨 마운트: ./log/media:/app/logs)
  file_path: "logs/media-server.log"
  # 로그 파일 최대 크기 (MB)
  max_size: 500
  # 로그 파일 최대 개수
  max_backups: 15
  # 로그 파일 보관기간 (일)
  max_age: 15

metrics:
  # Prometheus 메트릭 활성화
  enabled: true
  # 메트릭 엔드포인트 포트
  port: 9090
  # 메트릭 수집 간격 (초)
  interval: 10

performance:
  # 고루틴 풀 크기 - 다중 스트림 동시 처리를 위해 증가
  worker_pool_size: 200
  # 읽기 버퍼 크기 (bytes) - 성능 향상을 위해 증가
  read_buffer_size: 8192
  # 쓰기 버퍼 크기 (bytes) - 성능 향상을 위해 증가
  write_buffer_size: 8192
  # GC 퍼센트 (기본값 100) - 메모리 압박 감소
  gc_percent: 50
