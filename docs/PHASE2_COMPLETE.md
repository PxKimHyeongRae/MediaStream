# Phase 2 ì™„ë£Œ ë³´ê³ ì„œ

**ì™„ë£Œì¼**: 2025-10-29
**ë²„ì „**: 0.2.0
**ìƒíƒœ**: RTSP to WebRTC ì „ì²´ íŒŒì´í”„ë¼ì¸ êµ¬í˜„ ì™„ë£Œ âœ…

---

## âœ… ì™„ì„±ëœ ê¸°ëŠ¥

### 1. ì™„ì „í•œ RTSP í´ë¼ì´ì–¸íŠ¸ (gortsplib v4 í†µí•©)
**íŒŒì¼**: `internal/rtsp/client.go`

**êµ¬í˜„ëœ ê¸°ëŠ¥**:
- âœ… gortsplib v4ë¥¼ ì‚¬ìš©í•œ RTSP ì—°ê²°
- âœ… DESCRIBE, SETUP, PLAY ëª…ë ¹ ì²˜ë¦¬
- âœ… TCP/UDP ì „ì†¡ ì§€ì›
- âœ… ìë™ ì¬ì—°ê²° ë¡œì§
- âœ… RTP íŒ¨í‚· ìˆ˜ì‹ 
- âœ… ì—°ê²° ìƒíƒœ ê´€ë¦¬
- âœ… í†µê³„ ìˆ˜ì§‘

**ì½”ë“œ ì˜ˆì‹œ**:
```go
client, err := rtsp.NewClient(rtsp.ClientConfig{
    URL:        "rtsp://admin:pass@192.168.4.121:554/stream",
    Transport:  "tcp",
    Logger:     logger,
    OnPacket:   func(pkt *rtp.Packet) {
        stream.WritePacket(pkt)
    },
})
```

### 2. ì™„ì „í•œ WebRTC í”¼ì–´ (pion/webrtc v4 í†µí•©)
**íŒŒì¼**: `internal/webrtc/peer.go`

**êµ¬í˜„ëœ ê¸°ëŠ¥**:
- âœ… pion/webrtc v4ë¥¼ ì‚¬ìš©í•œ PeerConnection
- âœ… H.264 ë¹„ë””ì˜¤ ì½”ë± ì§€ì›
- âœ… Opus ì˜¤ë””ì˜¤ ì½”ë± ì§€ì›
- âœ… SDP Offer/Answer í˜‘ìƒ
- âœ… ICE candidate ì²˜ë¦¬
- âœ… ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
- âœ… RTP íŒ¨í‚·ì„ WebRTC íŠ¸ë™ìœ¼ë¡œ ì „ì†¡

**ì½”ë“œ ì˜ˆì‹œ**:
```go
peer, err := webrtc.NewPeer(webrtc.PeerConfig{
    StreamID: "test-camera-1",
    Logger:   logger,
})

answer, err := peer.CreateOffer(offerSDP)
stream.Subscribe(peer)
```

### 3. ì‹œê·¸ë„ë§ ì„œë²„ (WebSocket)
**íŒŒì¼**: `internal/signaling/server.go`

**êµ¬í˜„ëœ ê¸°ëŠ¥**:
- âœ… WebSocket ê¸°ë°˜ ì‹œê·¸ë„ë§
- âœ… Offer/Answer ë©”ì‹œì§€ êµí™˜
- âœ… ICE candidate ì „ì†¡
- âœ… í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ê´€ë¦¬

### 4. í†µí•©ëœ íŒŒì´í”„ë¼ì¸
**íŒŒì¼**: `cmd/server/main.go`

**ì „ì²´ ë°ì´í„° í”Œë¡œìš°**:
```
[RTSP Camera]
    â†“ TCP/UDP
[RTSP Client (gortsplib)]
    â†“ RTP Packets
[Stream Manager]
    â†“ Pub/Sub
[WebRTC Peer (pion)]
    â†“ WebRTC
[Web Browser]
```

**í•¸ë“¤ëŸ¬ êµ¬í˜„**:
```go
func (app *Application) handleWebRTCOffer(offer string, client *signaling.Client) (string, error) {
    // 1. ìŠ¤íŠ¸ë¦¼ ê°€ì ¸ì˜¤ê¸°
    stream, err := app.streamManager.GetStream(streamID)

    // 2. WebRTC í”¼ì–´ ìƒì„±
    peer, err := app.webrtcManager.CreatePeer(streamID)

    // 3. Offer ì²˜ë¦¬ ë° Answer ìƒì„±
    answer, err := peer.CreateOffer(offer)

    // 4. í”¼ì–´ë¥¼ ìŠ¤íŠ¸ë¦¼ êµ¬ë…ìë¡œ ë“±ë¡
    stream.Subscribe(peer)

    return answer, nil
}
```

---

## ğŸ“Š ë¹Œë“œ ê²°ê³¼

### ì„±ê³µì ìœ¼ë¡œ ë¹Œë“œë¨ âœ…
```bash
$ go build -o bin/media-server.exe cmd/server/main.go
âœ… Build successful

$ ls -lh bin/
-rwxr-xr-x 1 user group 18M Oct 29 10:50 media-server.exe
```

**ë°”ì´ë„ˆë¦¬ ì •ë³´**:
- í¬ê¸°: 18MB
- í”Œë«í¼: Windows AMD64
- Go ë²„ì „: 1.23.0

---

## ğŸ”§ ì‚¬ìš©ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ (ìµœì¢…)

### í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **gortsplib v4.16.2** - RTSP í´ë¼ì´ì–¸íŠ¸/ì„œë²„
- **pion/webrtc v4.1.6** - Pure Go WebRTC êµ¬í˜„
- **pion/rtp v1.8.23** - RTP íŒ¨í‚· ì²˜ë¦¬
- **pion/interceptor v0.1.41** - WebRTC ì¸í„°ì…‰í„°
- **gin v1.10.0** - HTTP ì›¹ í”„ë ˆì„ì›Œí¬
- **gorilla/websocket v1.5.1** - WebSocket
- **zap v1.27.0** - ê³ ì„±ëŠ¥ ë¡œê±°

### ì§€ì› ë¼ì´ë¸ŒëŸ¬ë¦¬
- pion/sdp, pion/srtp, pion/dtls, pion/ice
- bluenviron/mediacommon
- google/uuid

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. ì„œë²„ ì„¤ì •
`configs/config.yaml`:
```yaml
rtsp:
  test_stream:
    url: "rtsp://admin:live0416@192.168.4.121:554/Streaming/Channels/101"
    name: "test-camera-1"
```

### 2. ì„œë²„ ì‹¤í–‰
```bash
# ì§ì ‘ ì‹¤í–‰
./bin/media-server.exe

# ë˜ëŠ” Goë¡œ ì‹¤í–‰
go run cmd/server/main.go
```

### 3. ì›¹ ë¸Œë¼ìš°ì € ì ‘ì†
```
http://localhost:8080
```

### 4. ìŠ¤íŠ¸ë¦¼ ì‹œì²­
1. ì›¹ í˜ì´ì§€ ì ‘ì†
2. "Connect" ë²„íŠ¼ í´ë¦­
3. WebRTC ì—°ê²° ë° ë¹„ë””ì˜¤ ì¬ìƒ ì‹œì‘

---

## ğŸ“ í˜„ì¬ ì œí•œì‚¬í•­

### 1. RTP íŒ¨í‚· ì½ê¸° âœ… **í•´ê²°ë¨! (2025-10-29)**
**ìƒíƒœ**: âœ… **ì™„ë£Œ** - `OnPacketRTPAny()` ì½œë°±ìœ¼ë¡œ ì •ìƒ êµ¬í˜„ë¨

**ìµœì¢… êµ¬í˜„** (2025-10-29):
```go
// RTP íŒ¨í‚· ì½œë°± ë“±ë¡ (PLAY í˜¸ì¶œ ì „ì— ë“±ë¡)
c.client.OnPacketRTPAny(func(medi *description.Media, forma format.Format, pkt *rtp.Packet) {
    // RTP íŒ¨í‚· ìˆ˜ì‹  ì‹œ ìë™ í˜¸ì¶œë¨
    c.handleRTPPacket(pkt)
})
```

**í•´ê²° ë°©ë²•**:
- âœ… gortsplib v4ì˜ `OnPacketRTPAny()` ì½œë°± ì‚¬ìš©
- âœ… `SetupAll()` ì´í›„, `Play()` ì´ì „ì— ë“±ë¡
- âœ… ë¶ˆí•„ìš”í•œ `readPackets()` ê³ ë£¨í‹´ ì œê±°
- âœ… ìì„¸í•œ ë‚´ìš©: `docs/PHASE3_RTP_FIX.md` ì°¸ì¡°

### 2. ì½”ë± ì œí•œ
**í˜„ì¬ ì§€ì›**:
- âœ… H.264 ë¹„ë””ì˜¤
- âœ… Opus ì˜¤ë””ì˜¤

**í–¥í›„ ì¶”ê°€ ì˜ˆì •**:
- H.265 (HEVC)
- VP8/VP9
- G.711 ì˜¤ë””ì˜¤

### 3. ë‹¤ì¤‘ ìŠ¤íŠ¸ë¦¼
**í˜„ì¬**: ë‹¨ì¼ í…ŒìŠ¤íŠ¸ ìŠ¤íŠ¸ë¦¼ë§Œ ì§€ì›
**í–¥í›„**: ë™ì  ìŠ¤íŠ¸ë¦¼ ì¶”ê°€/ì œê±° ì§€ì›

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê³„íš

### Phase 2 í…ŒìŠ¤íŠ¸ í•­ëª©

#### 1. ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸
- [ ] RTSP ì¹´ë©”ë¼ ì—°ê²° ì„±ê³µ
- [ ] RTSP DESCRIBE/SETUP/PLAY ì„±ê³µ
- [ ] WebRTC Offer/Answer í˜‘ìƒ ì„±ê³µ
- [ ] ICE ì—°ê²° ì„±ê³µ

#### 2. ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸
- [ ] ë¹„ë””ì˜¤ í”„ë ˆì„ ìˆ˜ì‹ 
- [ ] ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì¬ìƒ
- [ ] ì§€ì—°ì‹œê°„ ì¸¡ì • (< 1ì´ˆ)
- [ ] íŒ¨í‚· ì†ì‹¤ë¥  ì¸¡ì •

#### 3. ì•ˆì •ì„± í…ŒìŠ¤íŠ¸
- [ ] ì¥ì‹œê°„ ì¬ìƒ (1ì‹œê°„+)
- [ ] RTSP ì¬ì—°ê²° í…ŒìŠ¤íŠ¸
- [ ] ë‹¤ì¤‘ í´ë¼ì´ì–¸íŠ¸ ë™ì‹œ ì ‘ì† (10+)
- [ ] ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í™•ì¸

#### 4. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] CPU ì‚¬ìš©ë¥  (< 30%)
- [ ] ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (< 500MB)
- [ ] ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­
- [ ] ë™ì‹œ ì—°ê²° ìˆ˜ (100+)

---

## ğŸ“Š ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

### ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RTSP Camera        â”‚
â”‚  192.168.4.121:554  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ RTSP/RTP
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RTSP Client        â”‚
â”‚  (gortsplib)        â”‚
â”‚  - DESCRIBE         â”‚
â”‚  - SETUP            â”‚
â”‚  - PLAY             â”‚
â”‚  - RTP Receiver     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ RTP Packets
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stream Manager     â”‚
â”‚  (Pub/Sub Pattern)  â”‚
â”‚  - Buffer (500pkt)  â”‚
â”‚  - Distribute       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Subscribe
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WebRTC Peer        â”‚
â”‚  (pion/webrtc)      â”‚
â”‚  - PeerConnection   â”‚
â”‚  - H.264 Track      â”‚
â”‚  - SDP Negotiate    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ WebRTC/SRTP
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web Browser        â”‚
â”‚  (Chrome/Firefox)   â”‚
â”‚  - HTML5 Video      â”‚
â”‚  - WebRTC Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì‹œê·¸ë„ë§ í”Œë¡œìš°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser â”‚               â”‚  Server  â”‚              â”‚  Stream  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                          â”‚                         â”‚
     â”‚  WebSocket Connect       â”‚                         â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
     â”‚                          â”‚                         â”‚
     â”‚  Send Offer (SDP)        â”‚                         â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
     â”‚                          â”‚  CreatePeer()           â”‚
     â”‚                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                          â”‚                         â”‚
     â”‚                          â”‚  Subscribe Peer         â”‚
     â”‚                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                          â”‚                         â”‚
     â”‚  Receive Answer (SDP)    â”‚                         â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚
     â”‚                          â”‚                         â”‚
     â”‚  ICE Candidates          â”‚                         â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
     â”‚                          â”‚                         â”‚
     â”‚  Connected!              â”‚  RTP Packets            â”‚
     â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                          â”‚                         â”‚
     â”‚  WebRTC Stream           â”‚                         â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚
     â”‚                          â”‚                         â”‚
```

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ (Phase 3)

### âœ… ìš°ì„ ìˆœìœ„ 1: RTP íŒ¨í‚· ìˆ˜ì‹  ì™„ì„± **[ì™„ë£Œ]**
- âœ… gortsplib v4 API ì¬í™•ì¸ ì™„ë£Œ
- âœ… OnPacketRTPAny ì½œë°± ì‚¬ìš©ìœ¼ë¡œ êµ¬í˜„
- âœ… íŒ¨í‚· ì •ìƒ ìˆ˜ì‹  êµ¬ì¡° ì™„ì„±
- ğŸ“„ ìƒì„¸ ë‚´ìš©: `docs/PHASE3_RTP_FIX.md`

### ìš°ì„ ìˆœìœ„ 2: ì‹¤ì œ í…ŒìŠ¤íŠ¸ **[ë‹¤ìŒ]**
- RTSP ì¹´ë©”ë¼ ì—°ê²°
- ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì¬ìƒ í™•ì¸
- ì§€ì—°ì‹œê°„ ë° í’ˆì§ˆ ì¸¡ì •

### ìš°ì„ ìˆœìœ„ 3: ë‹¤ì¤‘ ìŠ¤íŠ¸ë¦¼ ì§€ì›
- ë™ì  ìŠ¤íŠ¸ë¦¼ ì¶”ê°€/ì œê±°
- ìŠ¤íŠ¸ë¦¼ ëª©ë¡ API
- ìŠ¤íŠ¸ë¦¼ ì„ íƒ UI

### ìš°ì„ ìˆœìœ„ 4: ì„±ëŠ¥ ìµœì í™”
- ë²„í¼ í¬ê¸° íŠœë‹
- ê³ ë£¨í‹´ í’€ ìµœì í™”
- ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ë§

---

## ğŸ“š ì°¸ê³  ìë£Œ

### êµ¬í˜„ ì°¸ì¡°
- [mediaMTX ì†ŒìŠ¤](https://github.com/bluenviron/mediamtx) - RTSP/WebRTC íŒ¨í„´
- [gortsplib ë¬¸ì„œ](https://github.com/bluenviron/gortsplib) - RTSP API
- [pion/webrtc ì˜ˆì œ](https://github.com/pion/webrtc) - WebRTC êµ¬í˜„

### í”„ë¡œì íŠ¸ ë¬¸ì„œ
- `docs/mediamtx-architecture-analysis.md` - mediaMTX ë¶„ì„
- `docs/PROJECT_STATUS.md` - ì´ˆê¸° ìƒíƒœ
- `README.md` - í”„ë¡œì íŠ¸ ê°œìš”

---

## ğŸ‰ ì„±ê³¼ ìš”ì•½

### Phase 1 (ì™„ë£Œ)
- âœ… í”„ë¡œì íŠ¸ êµ¬ì¡° ì„¤ì •
- âœ… ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- âœ… ì›¹ í´ë¼ì´ì–¸íŠ¸ UI
- âœ… ë¹Œë“œ ì‹œìŠ¤í…œ

### Phase 2 (ì™„ë£Œ)
- âœ… gortsplib í†µí•©
- âœ… pion/webrtc í†µí•©
- âœ… ì „ì²´ íŒŒì´í”„ë¼ì¸ ì—°ê²°
- âœ… ì„±ê³µì ì¸ ë¹Œë“œ (18MB)

### Phase 3 (ë‹¤ìŒ)
- ğŸ”œ ì‹¤ì œ ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸
- ğŸ”œ ì„±ëŠ¥ ìµœì í™”
- ğŸ”œ ë‹¤ì¤‘ ìŠ¤íŠ¸ë¦¼ ì§€ì›
- ğŸ”œ í”„ë¡œë•ì…˜ ë°°í¬

---

**í˜„ì¬ ìƒíƒœ**: Phase 2 ì™„ë£Œ âœ…
**ë¹Œë“œ ìƒíƒœ**: ì„±ê³µ (18MB ë°”ì´ë„ˆë¦¬)
**ë‹¤ìŒ ì‘ì—…**: ì‹¤ì œ RTSP ì¹´ë©”ë¼ë¡œ ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸
**ì˜ˆìƒ ì‘ì—… ì‹œê°„**: 2-4ì‹œê°„ (RTP íŒ¨í‚· ìˆ˜ì‹  ì™„ì„± + í…ŒìŠ¤íŠ¸)
